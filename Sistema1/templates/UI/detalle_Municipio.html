{% extends "UI/base.html" %}
{% load static %}

{% block content %}


<div class="container-fluid mt-4">
    <h1 class="text-center">Convenios de {{ municipio.nombre }}</h1>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <!-- Botón a la izquierda -->
        <a class="btn btn-danger" href="{% url 'addConv' %}">
            <i class="fas fa-plus"></i> Agregar Convenios
        </a>

        <!-- Formulario de búsqueda -->
        <form class="d-flex" role="search" method="get">
            <input class="form-control me-2" type="search" placeholder="Buscar" name="buscar" aria-label="Search">
            <button class="btn btn-primary" type="submit">
                <i class="fas fa-search"></i>
            </button>
        </form>
        
    </div>
    <div class="row mt-3">
        <div class="col-12">
            <div class="table-responsive">
                {% if convenios %}
                <table class="table table-striped table-bordered">
                    <thead class="text-center">
                        <tr>
                            <th>Convenio</th>
                            <th>Descripción</th> <!-- N_Resolucion-->
                            <th>N°Resolución</th>
                            <th>Fecha</th>
                            <th>Localidad</th>
                            <th>Total</th>
                            <th>Convenio</th>
                            <th>Opciones</th>                          
                        </tr>
                    </thead>
                    <tbody> 
                        {% for m in convenios %}
                        <tr>
                            <td>{{ m.nombre }}</td>
                            <td>{{ m.descripcion }}</td>
                            <td>{{ m.res }}</td>
                            <td>{{ m.fecha }}</td>
                            <td>{{ m.lcl }}</td>
                            <td>{{ m.total }}</td>
                            <td class="text-center">
                                <a href="{{ m.documento.url }}" target="_blank" class="btn btn-link text-primary" title="Ver documento">
                                    <i class="bi bi-file-earmark-pdf"></i>
                                </a>
                            </td>
                            <td class="text-center">
                                <a href="{% url 'H_convenio' id=m.id %}" class="btn btn-link text-info" title="Historial">
                                    <i class="bi bi-clock-history"></i>
                                </a>
                                <a href="{% url 'actualizar_Conv' id=m.id %}" class="btn btn-link text-warning" title="Actualizar">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <!-- <a href="{% url 'eliminar_Conv' id=m.id %}" class="btn btn-link text-danger" title="Eliminar" onclick="return confirm('¿Estás seguro de eliminar este convenio?');">
                                    <i class="bi bi-trash"></i>
                                </a> -->

                                     <a href="#"   class="btn btn-link text-danger"    title="Eliminar"    onclick="confirmDelete('{% url 'eliminar_Conv' id=m.id %}')">
                                       <i class="bi bi-trash"></i>
                                     </a>  

                                <a href="{% url 'rendiciones' id=m.id %}" class="btn btn-link text-success" title="Rendiciones">
                                    <i class="bi bi-calendar2-week"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-center text-danger">No se encuentran convenios</p>
                {% endif %}
            </div>
        </div>
    </div>


       <!-- Paginación -->
       <div class="row">
        <div class="col-12 text-center">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    {% if convenios.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ convenios.previous_page_number }}" aria-label="Anterior">
                            Anterior
                        </a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">Anterior</span>
                    </li>
                    {% endif %}

                    {% for num in convenios.paginator.page_range %}
                    <li class="page-item {% if convenios.number == num %}active{% endif %}">
                        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                    </li>
                    {% endfor %}

                    {% if convenios.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ convenios.next_page_number }}" aria-label="Siguiente">
                            Siguiente
                        </a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">Siguiente</span>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>  

</div>

<script>
    function confirmDelete(deleteUrl) {
      Swal.fire({
        title: '¿Estás seguro?',
        text: "Esta acción no se puede deshacer.",
        icon: 'warning', // Ícono de advertencia
        showCancelButton: true, // Botón de cancelar
        confirmButtonColor: '#d33', // Color del botón de confirmar
        cancelButtonColor: '#6c757d', // Color del botón de cancelar
        confirmButtonText: 'Sí, eliminar',
        cancelButtonText: 'Cancelar',
        backdrop: true, // Fondo semi-transparente
        allowOutsideClick: false, // Desactiva clics fuera del modal
      }).then((result) => {
        if (result.isConfirmed) {
          // Redirige al enlace de eliminación
          window.location.href = deleteUrl;
        }
      });
    }
  </script>
  
  

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

{% endblock %}
